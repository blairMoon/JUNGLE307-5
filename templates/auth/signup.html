{% extends "base.html" %}

{% block title %}íšŒì›ê°€ì…{% endblock %}

{% block content %}
<h2>íšŒì›ê°€ì…</h2>

<!-- âœ… ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ SSRì—ì„œ í‘œì‹œ -->
{% if error %}
<p id="error-message" style="color:red;">{{ error }}</p>
{% endif %}

<body>
    {% with messages = get_flashed_messages() %} {% if messages %}
    <script>
      alert("{{ messages[0] }}");
    </script>
    {% endif %} {% endwith %}
    <div class="box">
      <div class="signup-container">
        <img
          src="{{ url_for('static', filename='images/logo2.png') }}"
          alt="ë¡œê³ "
          class="logo"
        />
        <h1 class="title">íšŒì›ê°€ì…</h1>
        <form action="{{ url_for('register') }}" method="POST" class="form-now">
          <!-- :ë¶ˆ: ì—ëŸ¬ ë©”ì‹œì§€ -->
          <!-- {% if error %}
          <p class="error-message">{{ error }}</p>
          {% endif %} -->
          <div class="select-box-container">
            <select name="lab_name" class="select-box" required>
              <option value="" disabled selected>ë© ë„¤ì„ ì„ íƒ</option>
              <option value="ì •ê¸€">ì •ê¸€</option>
              <option value="ê²Œì„ë©">ê²Œì„ë©</option>
              <option value="ê²Œì„í…Œí¬ë©">ê²Œì„í…Œí¬ë©</option>
            </select>
            <input
              type="text"
              name="cohort_name"
              class="text-input"
              placeholder="ê¸°ìˆ˜ëª… ì…ë ¥ EX) 8ê¸°-76"
              required
            />
            <button type="submit" class="jungbok-btn">ì¤‘ë³µí™•ì¸</button>
          </div>
          <div class="input-group">
            <label for="student_name">ì´ë¦„</label>
            <input
              type="text"
              name="student_name"
              class="text-input-label"
              placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”"
              required
            />
          </div>
          <div class="input-group">
            <label for="password">ë¹„ë°€ë²ˆí˜¸</label>
            <input
              type="password"
              name="password"
              class="text-input-label"
              placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”"
              required
            />
          </div>
          <div class="input-group">
            <label for="password_confirm">ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
            <input
              type="password"
              name="password_confirm"
              class="text-input-label"
              placeholder="ë¹„ë°€ë²ˆí˜¸ í™•ì¸"
              required
            />
          </div>
          <button type="submit" class="submit-btn">ê°€ì…í•˜ê¸°</button>
        </form>
      </div>
    </div>
  </body>

<script>
    document.getElementById("check_duplicate_btn").addEventListener("click", function () {
        const labName = document.getElementById("lab_name").value.trim();
        const cohortName = document.getElementById("cohort_name").value.trim();
        const messageEl = document.getElementById("duplicate-message");
    
        if (!labName || !cohortName) {
            messageEl.innerText = "âŒ ë© ì´ë¦„ê³¼ ê¸°ìˆ˜ëª…ì„ ì…ë ¥í•˜ì„¸ìš”.";
            return;
        }
    
        fetch("/api/check-duplicate", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ lab_name: labName, cohort_name: cohortName })
        })
        .then(response => response.json())
        .then(data => {
            messageEl.innerText = data.is_duplicate ? "ğŸš¨ ì¤‘ë³µëœ ì¡°í•©ì…ë‹ˆë‹¤!" : "âœ… ì‚¬ìš© ê°€ëŠ¥!";
            messageEl.style.color = data.is_duplicate ? "red" : "green";
        })
        .catch(error => {
            console.error("âŒ Error:", error);
            messageEl.innerText = "âŒ ì„œë²„ ì˜¤ë¥˜ ë°œìƒ";
            messageEl.style.color = "red";
        });
    });
    </script>

{% endblock %}
