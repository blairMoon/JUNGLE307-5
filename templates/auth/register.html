<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>íšŒì›ê°€ì…</title>

    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/register.css') }}"
    />
  </head>

  <body>
    {% with messages = get_flashed_messages() %} {% if messages %}
    <script>
      alert("{{ messages[0] }}");
    </script>
    {% endif %} {% endwith %}
    <div class="box">
      <div class="signup-container">
        <img
          src="{{ url_for('static', filename='images/logo2.png') }}"
          alt="ë¡œê³ "
          class="logo"
        />
        <h1 class="title">íšŒì›ê°€ì…</h1>
        <form action="{{ url_for('register') }}" method="POST" class="form-now">
          <!-- ğŸ”¥ ì—ëŸ¬ ë©”ì‹œì§€ -->
          <!-- {% if error %}
          <p class="error-message">{{ error }}</p>
          {% endif %} -->

          <div class="select-box-container">
            <select name="lab_name" class="select-box" required>
              <option value="" disabled selected>ë© ë„¤ì„ ì„ íƒ</option>
              <option value="ì •ê¸€">ì •ê¸€</option>
              <option value="ê²Œì„ë©">ê²Œì„ë©</option>
              <option value="ê²Œì„í…Œí¬ë©">ê²Œì„í…Œí¬ë©</option>
            </select>
            <input
              type="text"
              name="cohort_name"
              class="text-input"
              placeholder="ê¸°ìˆ˜ëª… ì…ë ¥ EX) 8ê¸°-76"
              required
            />
            <button type="button" class="jungbok-btn">ì¤‘ë³µí™•ì¸</button>
          </div>

          <div class="input-group">
            <label for="student_name">ì´ë¦„</label>
            <input
              type="text"
              name="student_name"
              class="text-input-label"
              placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”"
              required
            />
          </div>

          <div class="input-group">
            <label for="password">ë¹„ë°€ë²ˆí˜¸</label>
            <input
              type="password"
              name="password"
              class="text-input-label"
              placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”"
              required
            />
          </div>

          <div class="input-group">
            <label for="password_confirm">ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
            <input
              type="password"
              name="password_confirm"
              class="text-input-label"
              placeholder="ë¹„ë°€ë²ˆí˜¸ í™•ì¸"
              required
            />
          </div>

          <button type="submit" class="submit-btn">ê°€ì…í•˜ê¸°</button>
        </form>
      </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
      $(document).ready(function () {
        $(".jungbok-btn").on("click", function () {
          const labName = $("#lab_name").val().trim();
          const cohortName = $("#cohort_name").val().trim();

          // ğŸ”¸ ì •ê·œì‹ ê²€ì‚¬
          const cohortRegex = /^[0-9]{1,2}ê¸°-[0-9]{2}$/;
          if (!cohortRegex.test(cohortName)) {
            alert("âŒ ìœ íš¨í•˜ì§€ ì•Šì€ ê¸°ìˆ˜ëª… í˜•ì‹ì…ë‹ˆë‹¤. (ì˜ˆ: 8ê¸°-76)");
            return;
          }

          // ğŸ”¸ ê°’ ì…ë ¥ ì—¬ë¶€ í™•ì¸
          if (!labName || !cohortName) {
            alert("âŒ ë© ì´ë¦„ê³¼ ê¸°ìˆ˜ëª…ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            return;
          }

          // ğŸ”¸ ì„œë²„ì— ì¤‘ë³µ ì²´í¬ ìš”ì²­
          $.ajax({
            url: "/api/check-duplicate",
            method: "POST",
            contentType: "application/json",
            data: JSON.stringify({
              lab_name: labName,
              cohort_name: cohortName,
            }),
            success: function (response) {
              if (response.is_duplicate) {
                alert("âš ï¸ ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ë‹‰ë„¤ì„(ê¸°ìˆ˜ëª…)ì…ë‹ˆë‹¤.");
              } else {
                alert("âœ… ì‚¬ìš© ê°€ëŠ¥í•œ ë‹‰ë„¤ì„ì…ë‹ˆë‹¤!");
              }
            },
            error: function (xhr) {
              const errMsg =
                xhr.responseJSON?.error || "âŒ ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
              alert(errMsg);
            },
          });
        });
      });
    </script>
  </body>
</html>
