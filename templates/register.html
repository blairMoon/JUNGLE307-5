<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>íšŒì›ê°€ì…</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/register.css') }}" />
</head>

<body>
  {% with messages = get_flashed_messages() %} {% if messages %}
  <script>
    alert("{{ messages[0] }}");
  </script>
  {% endif %} {% endwith %}
  <div class="box">
    <div class="signup-container">
      <img src="{{ url_for('static', filename='images/logo2.png') }}" alt="ë¡œê³ " class="logo" />
      <h1 class="title">íšŒì›ê°€ì…</h1>
      <form action="{{ url_for('register') }}" method="POST" class="form-now">
        <!-- :ë¶ˆ: ì—ëŸ¬ ë©”ì‹œì§€ -->
        <!-- {% if error %}
          <p class="error-message">{{ error }}</p>
          {% endif %} -->
        <div class="select-box-container">
          <select name="lab_name" class="select-box" required>
            <option value="" disabled selected>ë© ë„¤ì„ ì„ íƒ</option>
            <option value="ì •ê¸€">ì •ê¸€</option>
            <option value="ê²Œì„ë©">ê²Œì„ë©</option>
            <option value="ê²Œì„í…Œí¬ë©">ê²Œì„í…Œí¬ë©</option>
          </select>
          <input type="text" name="cohort_name" class="text-input" placeholder="ê¸°ìˆ˜ëª… ì…ë ¥ EX) 8ê¸°-76" required />
          <button type="submit" class="jungbok-btn" id="check_duplicate_btn" >ì¤‘ë³µí™•ì¸</button>
          <script>
            document.addEventListener("DOMContentLoaded", function () {
              const checkDuplicateBtn = document.querySelector(".jungbok-btn");
              checkDuplicateBtn.addEventListener("click", function (event) {
                event.preventDefault(); // ê¸°ë³¸ ì œì¶œ ë°©ì§€
        
                // ì…ë ¥ê°’ ê°€ì ¸ì˜¤ê¸°
                const labName = document.querySelector("[name='lab_name']").value;
                const cohortName = document.querySelector("[name='cohort_name']").value.trim();
        
                if (!labName || !cohortName) {
                  alert("âŒ ë© ì´ë¦„ê³¼ ê¸°ìˆ˜ëª…ì„ ì…ë ¥í•˜ì„¸ìš”.");
                  return;
                }
        
                // API ìš”ì²­ ë³´ë‚´ê¸°
                fetch("/api/check-duplicate", {
                  method: "POST",
                  headers: { "Content-Type": "application/json" },
                  body: JSON.stringify({ lab_name: labName, cohort_name: cohortName })
                })
                  .then(response => response.json())
                  .then(data => {
                    if (data.is_duplicate) {
                      alert("ğŸš¨ ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ê¸°ìˆ˜ëª…ì…ë‹ˆë‹¤!");
                    } else {
                      alert("âœ… ì‚¬ìš© ê°€ëŠ¥í•œ ê¸°ìˆ˜ëª…ì…ë‹ˆë‹¤!");
                    }
                  })
                  .catch(error => {
                    console.error("âŒ ì¤‘ë³µ ê²€ì‚¬ ì˜¤ë¥˜:", error);
                    alert("âŒ ì„œë²„ ì˜¤ë¥˜ ë°œìƒ, ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
                  });
              });
            });
            </script>
        </div>
        <div class="input-group">
          <label for="student_name">ì´ë¦„</label>
          <input type="text" name="student_name" class="text-input-label" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" required />
        </div>
        <div class="input-group">
          <label for="password">ë¹„ë°€ë²ˆí˜¸</label>
          <input type="password" name="password" class="text-input-label" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”" required />
        </div>
        <div class="input-group">
          <label for="password_confirm">ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
          <input type="password" name="password_confirm" class="text-input-label" placeholder="ë¹„ë°€ë²ˆí˜¸ í™•ì¸" required />
        </div>
        <button type="submit" class="submit-btn" >ê°€ì…í•˜ê¸°</button>
      </form>
    </div>
  </div>
</body>

</html>